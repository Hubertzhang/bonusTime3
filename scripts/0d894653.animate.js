function init(){var a=document.querySelector(".ip-slideshow");canvas=document.createElement("canvas"),canvas.width=innerWidth,canvas.height=700,a.appendChild(canvas),context=canvas.getContext("2d"),randomOrder(),createParticles(),showPic()}function createParticles(){for(var a=0,b=200;b>a;a++){var c,d,e=2*Math.PI*a/b;c=.5*canvas.width+10*Math.cos(e),d=180+10*Math.sin(e);var f=randomBetween(0,12),g=!(f>0||12>f),h=colors[10][Math.floor(Math.random()*colors[10].length)];particles.push({x:c,y:d,hasBorn:g,ease:.04+.06*Math.random(),bornSpeed:.07+.07*Math.random(),alpha:0,maxAlpha:.7+.4*Math.random(),radius:f,maxRadius:12,color:h,angle:0,steps:e})}for(var i=0;3>i;i++)updateText(i,word[i],200);loop()}function changeWord(a,b,c){nextText[a]=[],updateText(a,b,c)}function createTextParticles(a,b){for(var c=0,d=b;d>c;c++){var e=randomBetween(0,12),f=!(e>0||12>e),g="#FFFFFF";text[a].push({x:.5*canvas.width+250*(a-1),y:canvas.height-100,hasBorn:f,ease:.04+.06*Math.random(),bornSpeed:.07+.07*Math.random(),alpha:0,maxAlpha:.7+.4*Math.random(),radius:e,maxRadius:12,color:g,interactive:!1})}}function updateText(a,b,c){clearWord(a),context.font=c+"px Lato, Arial, sans-serif",context.fillStyle="rgb(255, 255, 255)",context.textAlign="center";var d=b.toUpperCase().split("").join(String.fromCharCode(8202));context.fillText(d,.5*canvas.width+250*(a-1),canvas.height-50);for(var e=context.getImageData(.5*canvas.width+250*(a-1)-125,canvas.height-250,250,250),f=0;f<e.width;f+=8)for(var g=0;g<e.height;g+=4){var h=e.data[g*e.width*4+4*f-1];255===h&&nextText[a].push({x:f+.5*canvas.width+250*(a-1)-125,y:g+canvas.height-250,orbit:randomBetween(1,3),angle:0})}clearWord(a);var i=nextText[a].length;createTextParticles(a,i)}function loop(){clear(),update(),render(),setTimeout(loop,1e3/FPS)}function clear(){context.clearRect(0,0,canvas.width,canvas.height)}function clearWord(a){context.clearRect(.5*canvas.width+240*(a-1)-130,canvas.height-250,250,250)}function updataTransition(){[].forEach.call(particles,function(a,b){switch(currentLayout){case 0:shape.x=.5*canvas.width+85*Math.cos(a.steps),shape.y=180+140*Math.sin(a.steps);break;case 1:reOrder[b]<100?(shape.x=.5*canvas.width+1,shape.y=40+280*(reOrder[b]/100)):(shape.x=.5*canvas.width-1,shape.y=320-(reOrder[b]-100)/100*280);break;case 2:if(reOrder[b]<87){var c=5*Math.PI/4*reOrder[b]/87;shape.x=.5*canvas.width-85*Math.cos(c),shape.y=113-85*Math.sin(c)}else reOrder[b]<156?(shape.x=.5*canvas.width+60-145*(reOrder[b]-87)/69,shape.y=173+147*(reOrder[b]-87)/69):(shape.x=.5*canvas.width-85+170*(reOrder[b]-156)/44,shape.y=320);break;case 3:if(reOrder[b]<93){var c=5*Math.PI/4*reOrder[b]/93-Math.PI/4;shape.x=.5*canvas.width+65*Math.sin(c),shape.y=105-65*Math.cos(c)}else{var c=5*Math.PI/4*(reOrder[b]-93)/107;shape.x=.5*canvas.width+75*Math.sin(c),shape.y=245-75*Math.cos(c)}break;case 4:reOrder[b]<76?(shape.x=50+.5*canvas.width,shape.y=280*reOrder[b]/76+40):reOrder[b]<127?(shape.y=227,shape.x=.5*canvas.width-93+186*(reOrder[b]-76)/51):(shape.x=.5*canvas.width+50-143*(reOrder[b]-127)/73,shape.y=40+187*(reOrder[b]-127)/73);break;case 5:if(reOrder[b]<46)shape.y=40,shape.x=.5*canvas.width-75+150*reOrder[b]/46;else if(reOrder[b]<86)shape.x=.5*canvas.width-75,shape.y=40+100*(reOrder[b]-46)/40;else if(reOrder[b]<109)shape.y=140,shape.x=.5*canvas.width-75+75*(reOrder[b]-86)/23;else{var c=19*Math.PI/14*(reOrder[b]-109)/91;shape.x=.5*canvas.width+90*Math.sin(c),shape.y=230-90*Math.cos(c)}break;case 6:if(reOrder[b]<60){var c=Math.PI*reOrder[b]/60;shape.x=.5*canvas.width+85*Math.cos(c),shape.y=125-85*Math.sin(c)}else if(reOrder[b]<80)shape.x=.5*canvas.width-85,shape.y=125+110*(reOrder[b]-60)/20;else{var c=2*Math.PI*(reOrder[b]-80)/120;shape.x=.5*canvas.width+85*Math.sin(c),shape.y=235+85*Math.cos(c)}break;case 7:reOrder[b]<70?(shape.y=40,shape.x=.5*canvas.width-85+170*reOrder[b]/70):(shape.x=.5*canvas.width+85-100*(reOrder[b]-70)/130,shape.y=40+280*(reOrder[b]-70)/130);break;case 8:if(reOrder[b]<92){var c=2*Math.PI*reOrder[b]/92;shape.x=.5*canvas.width+65*Math.sin(c),shape.y=105+65*Math.cos(c)}else{var c=2*Math.PI*(reOrder[b]-92)/108;shape.x=.5*canvas.width+75*Math.sin(c),shape.y=245+75*Math.cos(c)}break;case 9:if(reOrder[b]<60){var c=Math.PI*reOrder[b]/60;shape.x=.5*canvas.width+85*Math.cos(c),shape.y=235+85*Math.sin(c)}else if(reOrder[b]<80)shape.x=.5*canvas.width+85,shape.y=235-110*(reOrder[b]-60)/20;else{var c=2*Math.PI*(reOrder[b]-80)/120;shape.x=.5*canvas.width+85*Math.sin(c),shape.y=125+85*Math.cos(c)}break;case 10:shape.x=.5*canvas.width+140*Math.sin(a.steps),shape.y=180+140*Math.cos(a.steps);break;case 11:var d,c;d=.5*particles.length-1,c=2*Math.PI*reOrder[b]/d,reOrder[b]<[].slice.call(particles,0,d).length?(shape.x=.5*canvas.width+80*Math.cos(c),shape.y=180+140*Math.sin(c)):(d=.5*particles.length,shape.x=.5*canvas.width+140*Math.cos(c),shape.y=180+80*Math.sin(c));break;case 12:shape.x=.5*canvas.width+90*(1-Math.sin(reOrder[b]))*Math.cos(reOrder[b]),shape.y=320+140*(-Math.sin(reOrder[b])-1);break;case 13:shape.x=.5*canvas.width+90*Math.sin(reOrder[b])*Math.cos(reOrder[b]),shape.y=320+140*(-Math.sin(reOrder[b])-1)}a.x+=.08*(shape.x+5*Math.cos(a.angle)-a.x),a.y+=.08*(shape.y+5*Math.sin(a.angle)-a.y),a.angle+=.08});for(var a=0;3>a;a++)if([].forEach.call(nextText[a],function(b,c){text[a][c].x+=.1*(b.x+Math.cos(b.angle+c)*b.orbit-text[a][c].x),text[a][c].y+=.1*(b.y+Math.sin(b.angle+c)*b.orbit-text[a][c].y),b.angle+=.08}),nextText[a].length<text[a].length)for(var b=[].slice.call(text[a],nextText[a].length,text[a].length),c=0;c<b.length;c++)text[a].splice(c,1)}function update(){updataTransition(),[].forEach.call(particles,function(a){a.alpha+=.05*(a.maxAlpha-a.alpha),a.hasBorn?(a.radius+=(0-a.radius)*a.bornSpeed,0===Math.round(a.radius)&&(a.color=colors[currentLayout][Math.floor(Math.random()*colors[currentLayout].length)],a.hasBorn=!1)):(a.radius+=(a.maxRadius-a.radius)*a.bornSpeed,Math.round(a.radius)===a.maxRadius&&(a.hasBorn=!0))});for(var a=0;3>a;a++)[].forEach.call(text[a],function(a){a.alpha+=.05*(a.maxAlpha-a.alpha),a.hasBorn&&(a.radius+=(0-a.radius)*a.bornSpeed,0===Math.round(a.radius)&&(a.hasBorn=!1)),a.hasBorn||(a.radius+=(a.maxRadius-a.radius)*a.bornSpeed,Math.round(a.radius)===a.maxRadius&&(a.hasBorn=!0))})}function render(){[].forEach.call(particles,function(a){context.save(),context.globalAlpha=a.alpha,context.fillStyle=a.color,context.beginPath(),context.arc(a.x,a.y+50,a.radius,0,2*Math.PI),context.fill(),context.restore()});for(var a=0;3>a;a++)[].forEach.call(text[a],function(a){context.save(),context.globalAlpha=a.alpha,context.fillStyle="rgb(255, 255, 255)",context.beginPath(),context.arc(a.x,a.y,a.radius,0,2*Math.PI),context.fill(),context.restore()})}function randomBetween(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function randomOrder(){for(var a=0,b=0;200>b;b++)reOrder[b]=b;for(var b=200;b>0;b--){a=randomBetween(0,b);var c=reOrder[a];reOrder[a]=reOrder[b-1],reOrder[b-1]=c}}function showPic(){(0==statusStep||1==isShowPic)&&(currentLayout++,10>currentLayout&&(currentLayout=10),currentLayout>=14&&(currentLayout=10),setTimeout(showPic,2e3))}function showNum(a,b){0!=statusStep&&0==isShowPic&&(currentNum=1==statusStep?randomBetween(0,maxHundredNum):randomBetween(0,9),randomOrder(),currentLayout=currentNum,console.log(a.toString()+" "+b.toString()),b>=1?setTimeout(function(){showNum(a,b-1)},max(1e3-100*b,100)):setTimeout(function(){changeWord(a,currentNum.toString(),225),isShowPic=1,showPic()},1300))}function max(a,b){return a>b?a:b}function randomNum(a){isShowPic=0,showNum(a,5)}function Start(){if(statusStep++,statusStep%=4,0==statusStep)for(var a=0;3>a;a++)changeWord(a,word[a],200);else randomNum(statusStep-1)}var self=window,canvas,context,particles=[],reOrder=[],maxHundredNum=7,text=[[],[],[]],nextText=[[],[],[]],shape={},FPS=60,type=["circle","ovals","drop","ribbon"],currentNum=0,currentLayout=9,statusStep=0,isShowPic=0,word=["码","戏","团"],colors=[["#e67e22","#2c3e50"],["#c0392b","#ff7e15"],["#1d75cf","#3a5945"],["#702744","#f98d00"],["#e67e22","#2c3e50"],["#c0392b","#ff7e15"],["#1d75cf","#3a5945"],["#702744","#f98d00"],["#e67e22","#2c3e50"],["#c0392b","#ff7e15"],["#e67e22","#2c3e50"],["#c0392b","#ff7e15"],["#1d75cf","#3a5945"],["#702744","#f98d00"]];$("body").keydown(function(a){console.log(a.which),32==a.which&&Start()}),window.onload=init;